<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>登录--仓库管理系统</title>
    <!-- 引入 Bootstrap CSS 文件 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* 居中对齐 */
        #app {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        
        /* 登录框样式 */
        .login-container {
            background-color: #f0f0f0; /* 设置背景色 */
            padding: 20px; /* 添加内边距 */
            border-radius: 10px; /* 设置圆角 */
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1); /* 添加阴影效果 */
            width: 300px; /* 设置宽度 */
        }
        .input-item {
            margin-bottom: 15px;
        }
        /* 修改验证码样式 */
        .captcha-input {
          position: relative; /* 让验证码输入框相对定位 */
        }
        .captcha-input img {
            position: absolute; /* 将验证码图片绝对定位 */
            right: 2.5%; /* 图片右对齐 */
            top: 2.5%; /* 图片顶部对齐 */
            max-height: 90%; /* 限制验证码图片的最大高度 */
        }
        .captcha-input input {
            width: 100%; /* 输入框宽度100% */
            padding-right: 30px; /* 预留验证码图片的空间 */
        }
        .btn-block {
          width: 100%;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="login-container">
            <div class="login_face"><img src="/resources/images/face.jpg" class="userAvatar"></div>
            <div class="input-item">

                <input type="text" placeholder="请输入账户" autocomplete="off" id="account" v-model="account" class="form-control" required>
            </div>
            <div class="input-item">

                <input type="password" placeholder="请输入密码" autocomplete="off" id="password" v-model="password" class="form-control" required>
            </div>
            <div class="input-item">
                <div class="captcha-input">
                    <input type="text" placeholder="请输入验证码" autocomplete="off" id="code" v-model="code" class="form-control" required>
                    <!-- 这里展示后端生成的验证码 -->
                    <img :src="captchaImage" alt="验证码" @click="refreshCaptcha">
                </div>
            </div>
            <div class="input-item">
                <button class="btn btn-primary btn-block" @click="login" :disabled="isLoginDisabled">登录</button>
            </div>
            <div class="input-item">
                <p>没有账户？<a href="/sys/toRegister">立刻注册</a></p>
            </div>
        </div>
    </div>

    <!-- 引入 Vue.js -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script>
    <!-- 引入 Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        new Vue({
            el: '#app',
            data: {
                account: '',
                password: '',
                code: '',
                captchaImage: '/login/getCode', // 默认验证码图片地址
                isLoginDisabled: false // 登录按钮是否禁用
            },
            methods: {
                login() {
                    // 禁用登录按钮
                    this.isLoginDisabled = true;
                    // 发起登录请求
                    axios.post("/login/login", {
                        account: this.account,
                        password: this.password,
                        code: this.code
                    })
                    .then(response => {
                        // 处理登录结果
                        alert(response.data.msg);
                        if(response.data.code === 200){
                            // 登录成功后的操作，比如页面跳转等
                            location.href = "/sys/index";
                        } else {
                            // 登录失败，刷新验证码
                            this.refreshCaptcha();
                        }
                    })
                    .catch(error => {
                        // 处理登录失败的逻辑
                        console.error('登录失败:', error);
                        // 允许重新登录
                        this.isLoginDisabled = false;
                    });
                },
                refreshCaptcha() {
                    // 生成一个随机数来刷新验证码图片，以避免缓存
                    this.captchaImage = '/login/getCode?' + Math.random();
                }
            }
        });
    </script>
</body>
</html>
